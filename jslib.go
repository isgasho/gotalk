package gotalk

const JSLibSHA1Base64 = "iiExWNNWieWvFahBuv2QhaZ3bps="
const JSLibString = "var gotalk=(function(){var K=Object.defineProperty,v=function(e,t){return function(){return t||(t={exports:{}},e(t.exports,t)),t.exports}},pe=function(e){return K(e,\"__esModule\",{value:!0})},ge=function(e,t){pe(e);for(var r in t)K(e,r,{get:t[r],enumerable:!0})};var R=v(function(x){\"use strict\";function X(e){for(var t=0,r=0,n;n=e.charCodeAt(r++);t+=n>>11?3:n>>7?2:1);return t}x.sizeOf=X;function T(e){return 255&e}if(typeof TextDecoder!=\"undefined\"){var he=new TextDecoder(\"utf8\"),ve=new TextEncoder(\"utf8\");x.decode=function(t){return he.decode(t)},x.encode=function(t){return ve.encode(t)}}else x.decode=function(t){var r=0,n=t.length-r,o,s,i=\"\";for(r=0;r<n;)o=t[r++],s=T(o),s<128||(s>>5==6?o=(o<<6&2047)+(t[r++]&63):s>>4==14?(o=(o<<12&65535)+(T(t[r++])<<6&4095),o+=t[r++]&63):s>>3==30&&(o=(o<<18&2097151)+(T(t[r++])<<12&262143),o+=T(t[r++])<<6&4095,o+=t[r++]&63)),i+=String.fromCharCode(o);return i},x.encode=function(t){for(var r=0,n=t.length,o,s=0,i=new Uint8Array(X(t));r!==n;)o=t.charCodeAt(r++),o<128?i[s++]=o:o<2048?(i[s++]=o>>6|192,i[s++]=o&63|128):o<65536?(i[s++]=o>>12|224,i[s++]=o>>6&63|128,i[s++]=o&63|128):(i[s++]=o>>18|240,i[s++]=o>>12&63|128,i[s++]=o>>6&63|128,i[s++]=o&63|128);return i}});var I=v(function(_e,Q){\"use strict\";var Y;if(typeof Uint8Array!=\"undefined\"){var Re=R();Y=function(t){return t instanceof Uint8Array?t:new Uint8Array(t instanceof ArrayBuffer?t:new ArrayBuffer(t))}}Q.exports=Y});var z=v(function(l){\"use strict\";var O=I(),B=R();l.Version=1;var Z=l.MsgTypeSingleReq=114,$=l.MsgTypeStreamReq=115,Ce=l.MsgTypeStreamReqPart=112,He=l.MsgTypeSingleRes=82,qe=l.MsgTypeStreamRes=83,Ae=l.MsgTypeErrorRes=69,_=l.MsgTypeRetryRes=101,C=l.MsgTypeNotification=110,H=l.MsgTypeHeartbeat=104,ee=l.MsgTypeProtocolError=102;l.ErrorAbnormal=0;l.ErrorUnsupported=1;l.ErrorInvalidMsg=2;l.ErrorTimeout=3;l.HeartbeatMsgMaxLoad=65535;function E(e,t,r,n){for(var o=t||0,s=0,i,a=r.toString(16),p=n-a.length;p--;)e[o++]=48;for(;!isNaN(i=a.charCodeAt(s++));)e[o++]=i}function te(e,t){var r=O(t);return E(r,0,e,t),r}function M(e){for(var t=0,r=0,n=0,o=!1;r<e.length;r++)n=e[r],n<64?(n<48&&(o=!0),n-=48):n<71?(n<65&&(o=!0),n-=55):n<103&&96<n?n-=87:o=!0,t=t<<4|n&15;if(o)throw new Error(\"invalid hexint \"+String.fromCharCode.apply(null,e));return t}l.binary={makeFixnum:te,versionBuf:te(l.Version,2),parseVersion:M,parseMsg:function(e){var t,r,n,o,s=0,i=0,a;return t=e[0],a=1,t===H?(s=M(e.subarray(a,a+4)),a+=4):t!==C&&t!==ee&&(r=e.subarray(a,a+4),a+=4),t==Z||t==$||t==C?(o=M(e.subarray(a,a+3)),a+=3,n=B.decode(e.subarray(a,a+o)),a+=o):t===_&&(s=M(e.subarray(a,a+8)),a+=8),i=M(e.subarray(a,a+8)),{t:t,id:r,name:n,wait:s,size:i}},makeMsg:function(e,t,r,n,o){var s,i,a=t?13:9;return r&&r.length!==0&&(i=B.encode(r),a+=3+i.length),s=O(a),s[0]=e,a=1,t&&t.length===4&&(typeof t==\"string\"?(s[1]=t.charCodeAt(0),s[2]=t.charCodeAt(1),s[3]=t.charCodeAt(2),s[4]=t.charCodeAt(3)):(s[1]=t[0],s[2]=t[1],s[3]=t[2],s[4]=t[3]),a+=4),i&&(E(s,a,i.length,3),a+=3,s.set(i,a),a+=i.length),e===_&&(E(s,a,n,8),a+=8),E(s,a,o,8),s},makeHeartbeatMsg:function(e){var t=O(13),r=1;return t[0]=H,E(t,r,e,4),r+=4,E(t,r,Math.round(new Date().getTime()/1e3),8),r+=8,t}};var me=\"00000000\";function b(e,t){var r=e.toString(16);return me.substr(0,t-r.length)+r}l.text={makeFixnum:b,versionBuf:b(l.Version,2),parseVersion:function(e){return parseInt(e.substr(0,2),16)},parseMsg:function(e){var t,r,n,o=0,s=0,i;return t=e.charCodeAt(0),i=1,t===H?(o=parseInt(e.substr(i,4),16),i+=4):t!==C&&t!==ee&&(r=e.substr(i,4),i+=4),t==Z||t==$||t==C?n=e.substring(i+3,e.length-8):t==_&&(o=parseInt(e.substr(i,8),16),i+=8),s=parseInt(e.substr(e.length-8),16),{t:t,id:r,name:n,wait:o,size:s}},makeMsg:function(e,t,r,n,o){var s=String.fromCharCode(e);return t&&t.length===4&&(s+=t),r&&r.length!==0&&(s+=b(B.sizeOf(r),3),s+=r),e===_&&(s+=b(n,8)),s+=b(o,8),s},makeHeartbeatMsg:function(e){var t=String.fromCharCode(H);return t+=b(e,4),t+=b(Math.round(new Date().getTime()/1e3),8),t}}});var P=v(function(Oe,re){function c(){}re.exports=c;c.prototype.addListener=function(e,t){if(typeof t!=\"function\")throw TypeError(\"listener must be a function\");if(!this.__events)return Object.defineProperty(this,\"__events\",{value:{},enumerable:!1,writable:!0}),this.__events[e]=[t],this;var r=this.__events[e];return r===void 0?(this.__events[e]=[t],this):(r.push(t),this)};c.prototype.on=c.prototype.addListener;c.prototype.once=function(e,t){var r=!1,n=function(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))};return this.on(e,n)};c.prototype.removeListener=function(e,t){var r,n=this.__events?this.__events[e]:void 0;if(n!==void 0){for(;(r=n.indexOf(t))!==-1;)n.splice(r,1);return n.length===0&&delete this.__events[e],n.length}return this};c.prototype.removeAllListeners=function(e){this.__events&&(e?delete this.__events[e]:delete this.__events)};c.prototype.listeners=function(e){return e?this.__events?this.__events[e]:void 0:this.__events};c.prototype.emit=function(e){var t=this.__events?this.__events[e]:void 0;if(t===void 0)return!1;for(var r=0,n=t.length,o=Array.prototype.slice.call(arguments,1);r!==n;++r)t[r]||console.log(\"e\",e,r,o),t[r].apply(this,o);return!0};c.mixin=function(t){for(var r=t;r;){if(r.__proto__===Object.prototype)return r.__proto__=c.prototype,t;r=r.__proto__}return t}});var F=v(function(N){N.global=typeof global!=\"undefined\"?global:typeof self!=\"undefined\"?self:typeof window!=\"undefined\"?window:N});var oe=v(function(ze,ne){\"use strict\";var be=P(),L=F(),m;L.addEventListener?(m=Object.create(be.prototype,{available:{value:!0,enumerable:!0},onLine:{value:!0,enumerable:!0,writable:!0}}),typeof navigator!=\"undefined\"&&(m.onLine=navigator.onLine),L.addEventListener(\"offline\",function(e){m.onLine=!1,m.emit(\"offline\")}),L.addEventListener(\"online\",function(e){m.onLine=!0,m.emit(\"online\")})):m={available:!1,onLine:!0};ne.exports=m});var ie=v(function(Pe,se){\"use strict\";var U=oe(),ye=z(),we=function(e,t,r,n){r?r<100&&(r=100):r=500,(!n||n<r)&&(n=5e3);var o,s,i,a=0,p,G;return o={isEnabled:!1,isConnected:!1,enable:function(){o.enabled||(o.enabled=!0,a=0,o.isConnected||s())},disable:function(){o.enabled&&(clearTimeout(p),o.enabled=!1,a=0)}},s=function(){clearTimeout(p),e.open(t,function(w){G=new Date,w?i(w):(a=0,o.isConnected=!0,e.once(\"close\",i))})},i=function(w){if(clearTimeout(p),o.isConnected=!1,!o.enabled)return;if(U.available&&!U.onLine&&!(typeof document!=\"undefined\"&&document.location&&document.location.hostname!==\"localhost\"&&document.location.hostname!==\"127.0.0.1\"&&document.location.hostname!==\"[::1]\")){U.once(\"online\",i),a=0;return}w?w.isGotalkProtocolError?w.code===ye.ErrorTimeout?a=0:a=n:a=a?Math.min(n,a*2):r:a=Math.max(0,r-(new Date-G)),p=setTimeout(s,a)},o};se.exports=we});var ce=v(function(g){ge(g,{default:function(){return le}});\"use strict\";var u=z(),ae=u.text,ue=u.binary,S=I(),W=R(),fe=P(),xe=ie(),Ne=F().global,d=g,le=g;d.protocol=u;d.Buf=S;function D(e){typeof e!=\"string\"&&(e=W.decode(e));try{return JSON.parse(e)}catch(t){typeof console!=\"undefined\"&&console.warn&&console.warn(\"[gotalk] ignoring invalid json\",e)}}function f(e,t){return Object.create(f.prototype,{handlers:{value:e,enumerable:!0},protocol:{value:t||(S?u.binary:u.text),enumerable:!0,writable:!0},heartbeatInterval:{value:20*1e3,enumerable:!0,writable:!0},ws:{value:null,writable:!0},keepalive:{value:null,writable:!0},nextOpID:{value:0,writable:!0},nextStreamID:{value:0,writable:!0},pendingRes:{value:{},writable:!0},hasPendingRes:{get:function(){for(var r in this.pendingRes)return!0}},pendingClose:{value:!1,writable:!0}})}f.prototype=fe.mixin(f.prototype);g.Sock=f;function Ee(e,t){if(e.pendingClose=!1,e.stopSendingHeartbeats(),e.ws&&(e.ws.onmessage=null,e.ws.onerror=null,e.ws.onclose=null,e.ws=null),e.nextOpID=0,e.hasPendingRes){var r=t||new Error(\"connection closed\");for(var n in e.pendingRes)e.pendingRes[n](r);e.pendingRes={}}}var Me={1e3:\"normal\",1001:\"going away\",1002:\"protocol error\",1003:\"unsupported\",1005:\"no status\",1006:\"abnormal\",1007:\"inconsistent\",1008:\"invalid message\",1009:\"too large\"};f.prototype.adoptWebSocket=function(e){var t=this;if(e.readyState!==WebSocket.OPEN)throw new Error(\"web socket readyState != OPEN\");e.binaryType=\"arraybuffer\",t.ws=e,e.onclose=function(r){var n=e._gotalkCloseError;!n&&r.code!==1e3&&(n=new Error(\"websocket closed: \"+(Me[r.code]||\"#\"+r.code))),Ee(t,n),t.emit(\"close\",n)},e.onmessage=function(r){e._bufferedMessages||(e._bufferedMessages=[]),e._bufferedMessages.push(r.data)}};f.prototype.adopt=function(e){if(adopt instanceof WebSocket)return this.adoptWebSocket(e);throw new Error(\"unsupported transport\")};f.prototype.handshake=function(){this.ws.send(this.protocol.versionBuf)};f.prototype.end=function(){var e=this;e.keepalive&&(e.keepalive.disable(),e.keepalive=null),!e.pendingClose&&e.hasPendingRes?e.pendingClose=!0:e.ws&&e.ws.close(1e3)};f.prototype.address=function(){var e=this;return e.ws?e.ws.url:null};var V=g.ErrAbnormal=Error(\"unsupported protocol\");V.isGotalkProtocolError=!0;V.code=u.ErrorAbnormal;var q=g.ErrUnsupported=Error(\"unsupported protocol\");q.isGotalkProtocolError=!0;q.code=u.ErrorUnsupported;var A=g.ErrInvalidMsg=Error(\"invalid protocol message\");A.isGotalkProtocolError=!0;A.code=u.ErrorInvalidMsg;var j=g.ErrTimeout=Error(\"timeout\");j.isGotalkProtocolError=!0;j.code=u.ErrorTimeout;f.prototype.sendHeartbeat=function(e){var t=this,r=t.protocol.makeHeartbeatMsg(Math.round(e*u.HeartbeatMsgMaxLoad));try{t.ws.send(r)}catch(n){throw(!this.ws||this.ws.readyState>WebSocket.OPEN)&&(n=new Error(\"socket is closed\")),n}};f.prototype.startSendingHeartbeats=function(){var e=this;if(e.heartbeatInterval<10)throw new Error(\"Sock.heartbeatInterval is too low\");clearTimeout(e._sendHeartbeatsTimer);var t=function(){clearTimeout(e._sendHeartbeatsTimer),e.sendHeartbeat(0),e._sendHeartbeatsTimer=setTimeout(t,e.heartbeatInterval)};e._sendHeartbeatsTimer=setTimeout(t,1)};f.prototype.stopSendingHeartbeats=function(){var e=this;clearTimeout(e._sendHeartbeatsTimer)};f.prototype.startReading=function(){var e=this,t=e.ws,r;function n(i){if(r=typeof i.data==\"string\"?ae.parseMsg(i.data):ue.parseMsg(S(i.data)),r.t===u.MsgTypeProtocolError){var a=r.size;a===u.ErrorAbnormal?t._gotalkCloseError=V:a===u.ErrorUnsupported?t._gotalkCloseError=q:a===u.ErrorTimeout?t._gotalkCloseError=j:t._gotalkCloseError=A,t.close(4e3+a)}else r.size!==0&&r.t!==u.MsgTypeHeartbeat?t.onmessage=o:(e.handleMsg(r),r=null)}function o(i){var a=i.data;t.onmessage=n,e.handleMsg(r,typeof a==\"string\"?a:S(a)),r=null}function s(i){var a=typeof i.data==\"string\"?ae.parseVersion(i.data):ue.parseVersion(S(i.data));a!==u.Version?(t._gotalkCloseError=q,e.closeError(u.ErrorUnsupported)):(t.onmessage=n,e.heartbeatInterval>0&&e.startSendingHeartbeats())}t.onmessage=s,t._bufferedMessages&&(t._bufferedMessages.forEach(function(i){t.onmessage({data:i})}),t._bufferedMessages=null)};var y={};f.prototype.handleMsg=function(e,t){var r=this,n=y[e.t];n?n.call(r,e,t):(r.ws&&(r.ws._gotalkCloseError=A),r.closeError(u.ErrorInvalidMsg))};y[u.MsgTypeSingleReq]=function(e,t){var r=this,n,o;if(n=r.handlers.findRequestHandler(e.name),o=function(s){r.sendMsg(u.MsgTypeSingleRes,e.id,null,0,s)},o.error=function(s){var i=s.message||String(s);r.sendMsg(u.MsgTypeErrorRes,e.id,null,0,i)},typeof n!=\"function\")o.error('no such operation \"'+e.name+'\"');else try{n(t,o,e.name)}catch(s){typeof console!=\"undefined\"&&console.error(s.stack||s),o.error(\"internal error\")}};function J(e,t){var r=e.id;typeof r!=\"string\"&&(r=String.fromCharCode.apply(null,r));var n=this,o=n.pendingRes[r];if((e.t!==u.MsgTypeStreamRes||!t||(t.length||t.size)===0)&&(delete n.pendingRes[r],n.pendingClose&&!n.hasPendingRes&&n.end()),typeof o!=\"function\")return;e.t===u.MsgTypeErrorRes?(typeof t!=\"string\"&&(t=W.decode(t)),o(new Error(t),null)):o(null,t)}y[u.MsgTypeSingleRes]=J;y[u.MsgTypeStreamRes]=J;y[u.MsgTypeErrorRes]=J;y[u.MsgTypeNotification]=function(e,t){var r=this.handlers.findNotificationHandler(e.name);r&&r(t,e.name)};y[u.MsgTypeHeartbeat]=function(e){this.emit(\"heartbeat\",{time:new Date(e.size*1e3),load:e.wait})};f.prototype.sendMsg=function(e,t,r,n,o){var s=o&&typeof o==\"string\"&&this.protocol===u.binary?W.sizeOf(o):o?o.length||o.size:0,i=this,a=i.protocol.makeMsg(e,t,r,n,s);try{i.ws.send(a),s!==0&&i.ws.send(o)}catch(p){throw(!this.ws||this.ws.readyState>WebSocket.OPEN)&&(p=new Error(\"socket is closed\")),p}};f.prototype.closeError=function(e){var t=this,r;if(t.ws){try{t.ws.send(t.protocol.makeMsg(u.MsgTypeProtocolError,null,null,0,e))}catch(n){}t.ws.close(4e3+e)}};var de=\"0000\";f.prototype.bufferRequest=function(e,t,r){var n=this,o=n.nextOpID++;n.nextOpID===1679616&&(n.nextOpID=0),o=o.toString(36),o=de.substr(0,4-o.length)+o,n.pendingRes[o]=r;try{n.sendMsg(u.MsgTypeSingleReq,o,e,0,t)}catch(s){delete n.pendingRes[o],r(s)}};f.prototype.bufferNotify=function(e,t){this.sendMsg(u.MsgTypeNotification,null,e,0,t)};f.prototype.request=function(e,t,r){var n;return r?n=JSON.stringify(t):r=t,this.bufferRequest(e,n,function(o,s){var i=D(s);return r(o,i)})};f.prototype.notify=function(e,t){var r=JSON.stringify(t);return this.bufferNotify(e,r)};f.prototype.requestp=function(e,t){var r=this;return new Promise(function(n,o){r.request(e,t,function(s,i){s?o(s):n(i)})})};f.prototype.bufferRequestp=function(e,t){var r=this;return new Promise(function(n,o){r.bufferRequest(e,t,function(s,i){s?o(s):n(i)})})};var k=function(e,t,r){return Object.create(k.prototype,{s:{value:e},op:{value:t,enumerable:!0},id:{value:r,enumerable:!0}})};fe.mixin(k.prototype);k.prototype.write=function(e){this.ended||(this.started?this.s.sendMsg(u.MsgTypeStreamReqPart,this.id,null,0,e):(this.started=!0,this.s.sendMsg(u.MsgTypeStreamReq,this.id,this.op,0,e)),(!e||e.length===0||e.size===0)&&(this.ended=!0))};k.prototype.end=function(){this.write(null)};f.prototype.streamRequest=function(e){var t=this,r=t.nextStreamID++;t.nextStreamID===46656&&(t.nextStreamID=0),r=r.toString(36),r=\"!\"+de.substr(0,3-r.length)+r;var n=k(t,e,r);return t.pendingRes[r]=function(o,s){o?n.emit(\"end\",o):!s||s.length===0?n.emit(\"end\",null):n.emit(\"data\",s)},n};function h(){return Object.create(h.prototype,{reqHandlers:{value:{}},reqFallbackHandler:{value:null,writable:!0},noteHandlers:{value:{}},noteFallbackHandler:{value:null,writable:!0}})}g.Handlers=h;h.prototype.handleBufferRequest=function(e,t){e?this.reqHandlers[e]=t:this.reqFallbackHandler=t};h.prototype.handleRequest=function(e,t){return this.handleBufferRequest(e,function(r,n,o){var s=function(a){return n(JSON.stringify(a))};s.error=n.error;var i=D(r);t(i,s,o)})};h.prototype.handleBufferNotification=function(e,t){e?this.noteHandlers[e]=t:this.noteFallbackHandler=t};h.prototype.handleNotification=function(e,t){this.handleBufferNotification(e,function(r,n){t(D(r),n)})};h.prototype.findRequestHandler=function(e){var t=this.reqHandlers[e];return t||this.reqFallbackHandler};h.prototype.findNotificationHandler=function(e){var t=this.noteHandlers[e];return t||this.noteFallbackHandler};function Se(e,t,r){var n;try{n=new WebSocket(t),n.binaryType=\"arraybuffer\",n.onclose=function(o){var s=new Error(\"connection failed\");r&&r(s)},n.onopen=function(o){n.onerror=void 0,e.adoptWebSocket(n),e.handshake(),r&&r(null,e),e.emit(\"open\"),e.startReading()},n.onmessage=function(o){n._bufferedMessages||(n._bufferedMessages=[]),n._bufferedMessages.push(o.data)}}catch(o){r&&r(o),e.emit(\"close\",o)}}d.defaultResponderAddress=function(){if(typeof document==\"undefined\")return;var e=document.currentScript.src;if(!e)return;var t=e.indexOf(\"://\")+3;if(t==2)return;var r=e.substr(0,t),n=e.indexOf(\"/\",t);if(n==-1)return;var o=e.substring(t,n);e=e.substr(n),t=e.lastIndexOf(\"?\"),t!=-1&&(e=e.substr(0,t));var s=e.substring(e.indexOf(\"/\"),e.lastIndexOf(\"/\")+1);return(r==\"https:\"?\"wss://\":\"ws://\")+o+s}()||\"\";f.prototype.open=function(e,t){var r=this;if(!t&&typeof e==\"function\"&&(t=e,e=null),!e){if(!d.defaultResponderAddress)throw new Error(\"address not specified (empty gotalk.defaultResponderAddress)\");e=d.defaultResponderAddress}return Se(r,e,t),r};d.open=function(e,t,r,n){return f(r||d.defaultHandlers,n).open(e,t)};f.prototype.openKeepAlive=function(e){var t=this;return t.keepalive&&t.keepalive.disable(),t.keepalive=xe(t,e),t.keepalive.enable(),t};d.connection=function(e,t,r){return f(t||d.defaultHandlers,r).openKeepAlive(e)};d.defaultHandlers=h();d.handleBufferRequest=function(e,t){return d.defaultHandlers.handleBufferRequest(e,t)};d.handle=function(e,t){return d.defaultHandlers.handleRequest(e,t)};d.handleBufferNotification=function(e,t){return d.defaultHandlers.handleBufferNotification(e,t)};d.handleNotification=function(e,t){return d.defaultHandlers.handleNotification(e,t)}});return ce();})();\n"
